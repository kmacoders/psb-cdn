/*! For license information please see component-psb-justified.js.LICENSE.txt */
!function(){"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();var e=function(t){var e=[],i=null,o=function(){for(var o=arguments.length,n=new Array(o),s=0;s<o;s++)n[s]=arguments[s];e=n,i||(i=requestAnimationFrame((function(){i=null,t.apply(void 0,e)})))};return o.cancel=function(){i&&(cancelAnimationFrame(i),i=null)},o},i={exports:{}};(i.exports=function(t){this.top=t.top,this.left=t.left,this.width=t.width,this.spacing=t.spacing,this.targetRowHeight=t.targetRowHeight,this.targetRowHeightTolerance=t.targetRowHeightTolerance,this.minAspectRatio=this.width/t.targetRowHeight*(1-t.targetRowHeightTolerance),this.maxAspectRatio=this.width/t.targetRowHeight*(1+t.targetRowHeightTolerance),this.edgeCaseMinRowHeight=t.edgeCaseMinRowHeight,this.edgeCaseMaxRowHeight=t.edgeCaseMaxRowHeight,this.widowLayoutStyle=t.widowLayoutStyle,this.isBreakoutRow=t.isBreakoutRow,this.items=[],this.height=0}).prototype={addItem:function(t){var e,i,o,n=this.items.concat(t),s=this.width-(n.length-1)*this.spacing,a=n.reduce((function(t,e){return t+e.aspectRatio}),0),r=s/this.targetRowHeight;return this.isBreakoutRow&&0===this.items.length&&t.aspectRatio>=1?(this.items.push(t),this.completeLayout(s/t.aspectRatio,"justify"),!0):a<this.minAspectRatio?(this.items.push(Object.assign({},t)),!0):a>this.maxAspectRatio?0===this.items.length?(this.items.push(Object.assign({},t)),this.completeLayout(s/a,"justify"),!0):(e=this.width-(this.items.length-1)*this.spacing,i=this.items.reduce((function(t,e){return t+e.aspectRatio}),0),o=e/this.targetRowHeight,Math.abs(a-r)>Math.abs(i-o)?(this.completeLayout(e/i,"justify"),!1):(this.items.push(Object.assign({},t)),this.completeLayout(s/a,"justify"),!0)):(this.items.push(Object.assign({},t)),this.completeLayout(s/a,"justify"),!0)},isLayoutComplete:function(){return this.height>0},completeLayout:function(t,e){var i,o,n,s,a,r=this.left,h=this.width-(this.items.length-1)*this.spacing;(void 0===e||["justify","center","left"].indexOf(e)<0)&&(e="left"),t!==(o=Math.max(this.edgeCaseMinRowHeight,Math.min(t,this.edgeCaseMaxRowHeight)))?(this.height=o,i=h/o/(h/t)):(this.height=t,i=1),this.items.forEach((function(t){t.top=this.top,t.width=t.aspectRatio*this.height*i,t.height=this.height,t.left=r,r+=t.width+this.spacing}),this),"justify"===e?(r-=this.spacing+this.left,n=(r-this.width)/this.items.length,s=this.items.map((function(t,e){return Math.round((e+1)*n)})),1===this.items.length?this.items[0].width-=Math.round(n):this.items.forEach((function(t,e){e>0?(t.left-=s[e-1],t.width-=s[e]-s[e-1]):t.width-=s[e]}))):"center"===e&&(a=(this.width-r)/2,this.items.forEach((function(t){t.left+=a+this.spacing}),this))},forceComplete:function(t,e){"number"==typeof e?this.completeLayout(e,this.widowLayoutStyle):this.completeLayout(this.targetRowHeight,this.widowLayoutStyle)},getItems:function(){return this.items}};var o=i.exports;function n(t,e){var i;return!1!==t.fullWidthBreakoutRowCadence&&(e._rows.length+1)%t.fullWidthBreakoutRowCadence==0&&(i=!0),new o({top:e._containerHeight,left:t.containerPadding.left,width:t.containerWidth-t.containerPadding.left-t.containerPadding.right,spacing:t.boxSpacing.horizontal,targetRowHeight:t.targetRowHeight,targetRowHeightTolerance:t.targetRowHeightTolerance,edgeCaseMinRowHeight:.5*t.targetRowHeight,edgeCaseMaxRowHeight:2*t.targetRowHeight,rightToLeft:!1,isBreakoutRow:i,widowLayoutStyle:t.widowLayoutStyle})}function s(t,e,i){return e._rows.push(i),e._layoutItems=e._layoutItems.concat(i.getItems()),e._containerHeight+=i.height+t.boxSpacing.vertical,i.items}let a;a="undefined"!=typeof window?window:void 0!==t.g?t.g:"undefined"!=typeof self?self:{};var r=a;const h=[],c=e((()=>{h.forEach((t=>{t.resize()}))}));var l;r.addEventListener("resize",c),r.addEventListener("orientationchange",c),r.addEventListener("load",c),l=()=>{c()},"complete"===document.readyState||"interactive"===document.readyState?l():document.addEventListener("DOMContentLoaded",l,{capture:!0,once:!0,passive:!0});let g=0;class d{constructor(t,i){const o=this;o.instanceID=g,g+=1,o.$container=t,o.images=[],o.defaults={itemSelector:".fj-gallery-item",imageSelector:"img",gutter:10,rowHeight:320,rowHeightTolerance:.25,maxRowsCount:Number.POSITIVE_INFINITY,lastRow:"left",transitionDuration:"0.3s",calculateItemsHeight:!1,resizeDebounce:100,isRtl:"rtl"===o.css(o.$container,"direction"),onInit:null,onDestroy:null,onAppendImages:null,onBeforeJustify:null,onJustify:null};const n=o.$container.dataset||{},s={};Object.keys(n).forEach((t=>{const e=t.substr(0,1).toLowerCase()+t.substr(1);e&&void 0!==o.defaults[e]&&(s[e]=n[t])})),o.options={...o.defaults,...s,...i},o.pureOptions={...o.options},o.resize=function(t,e,i){var o=(i||{}).atBegin;return function(t,e,i){var o,n=i||{},s=n.noTrailing,a=void 0!==s&&s,r=n.noLeading,h=void 0!==r&&r,c=n.debounceMode,l=void 0===c?void 0:c,g=!1,d=0;function u(){o&&clearTimeout(o)}function p(){for(var i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];var r=this,c=Date.now()-d;function p(){d=Date.now(),e.apply(r,n)}function f(){o=void 0}g||(h||!l||o||p(),u(),void 0===l&&c>t?h?(d=Date.now(),a||(o=setTimeout(l?f:p,t))):p():!0!==a&&(o=setTimeout(l?f:p,void 0===l?t-c:t)))}return p.cancel=function(t){var e=(t||{}).upcomingOnly,i=void 0!==e&&e;u(),g=!i},p}(t,e,{debounceMode:!1!==(void 0!==o&&o)})}(o.options.resizeDebounce,o.resize),o.justify=e(o.justify.bind(o)),o.init()}css(t,e){return"string"==typeof e?r.getComputedStyle(t).getPropertyValue(e):(Object.keys(e).forEach((i=>{t.style[i]=e[i]})),t)}applyTransition(t,e){const i=this;i.onTransitionEnd(t)(),i.css(t,{"transition-property":e.join(", "),"transition-duration":i.options.transitionDuration}),t.addEventListener("transitionend",i.onTransitionEnd(t,e),!1)}onTransitionEnd(t){const e=this;return()=>{e.css(t,{"transition-property":"","transition-duration":""}),t.removeEventListener("transitionend",e.onTransitionEnd(t))}}addToFjGalleryList(){h.push(this),c()}removeFromFjGalleryList(){const t=this;h.forEach(((e,i)=>{e.instanceID===t.instanceID&&h.splice(i,1)}))}init(){const t=this;t.appendImages(t.$container.querySelectorAll(t.options.itemSelector)),t.addToFjGalleryList(),t.options.onInit&&t.options.onInit.call(t)}appendImages(t){const e=this;r.jQuery&&t instanceof r.jQuery&&(t=t.get()),t&&t.length&&(t.forEach((t=>{if(t&&!t.fjGalleryImage&&t.querySelector){const i=t.querySelector(e.options.imageSelector);if(i){t.fjGalleryImage=e;const o={$item:t,$image:i,width:parseFloat(i.getAttribute("width"))||!1,height:parseFloat(i.getAttribute("height"))||!1,loadSizes(){const t=this;!function(t,e){let i,o=!1,n=!1;const s=()=>{o?e(o):t.naturalWidth&&(o={width:t.naturalWidth,height:t.naturalHeight},e(o),clearInterval(i),n&&c())},a=()=>{s()},r=()=>{s()},h=()=>{0<t.naturalWidth&&s()},c=()=>{n=!1,t.removeEventListener("load",a),t.removeEventListener("error",r)};h(),o||(n=!0,t.addEventListener("load",a),t.addEventListener("error",r),i=setInterval(h,100))}(i,(i=>{t.width===i.width&&t.height===i.height||(t.width=i.width,t.height=i.height,e.resize())}))}};o.loadSizes(),e.images.push(o)}}})),e.options.onAppendImages&&e.options.onAppendImages.call(e,[t]),e.justify())}justify(){const t=this,e=[];t.justifyCount=(t.justifyCount||0)+1,t.options.onBeforeJustify&&t.options.onBeforeJustify.call(t),t.images.forEach((t=>{t.width&&t.height&&e.push(t.width/t.height)}));const i={containerWidth:t.$container.getBoundingClientRect().width,containerPadding:{top:parseFloat(t.css(t.$container,"padding-top"))||0,right:parseFloat(t.css(t.$container,"padding-right"))||0,bottom:parseFloat(t.css(t.$container,"padding-bottom"))||0,left:parseFloat(t.css(t.$container,"padding-left"))||0},boxSpacing:t.options.gutter,targetRowHeight:t.options.rowHeight,targetRowHeightTolerance:t.options.rowHeightTolerance,maxNumRows:t.options.maxRowsCount,showWidows:"hide"!==t.options.lastRow},o=(a=e,r=i,h={},c={},l={containerWidth:1060,containerPadding:10,boxSpacing:10,targetRowHeight:320,targetRowHeightTolerance:.25,maxNumRows:Number.POSITIVE_INFINITY,forceAspectRatio:!1,showWidows:!0,fullWidthBreakoutRowCadence:!1,widowLayoutStyle:"left"},g={},d={},r=r||{},h=Object.assign(l,r),g.top=isNaN(parseFloat(h.containerPadding.top))?h.containerPadding:h.containerPadding.top,g.right=isNaN(parseFloat(h.containerPadding.right))?h.containerPadding:h.containerPadding.right,g.bottom=isNaN(parseFloat(h.containerPadding.bottom))?h.containerPadding:h.containerPadding.bottom,g.left=isNaN(parseFloat(h.containerPadding.left))?h.containerPadding:h.containerPadding.left,d.horizontal=isNaN(parseFloat(h.boxSpacing.horizontal))?h.boxSpacing:h.boxSpacing.horizontal,d.vertical=isNaN(parseFloat(h.boxSpacing.vertical))?h.boxSpacing:h.boxSpacing.vertical,h.containerPadding=g,h.boxSpacing=d,c._layoutItems=[],c._awakeItems=[],c._inViewportItems=[],c._leadingOrphans=[],c._trailingOrphans=[],c._containerHeight=h.containerPadding.top,c._rows=[],c._orphans=[],h._widowCount=0,function(t,e,i){var o,a,r,h=[];return t.forceAspectRatio&&i.forEach((function(e){e.forcedAspectRatio=!0,e.aspectRatio=t.forceAspectRatio})),i.some((function(i,r){if(isNaN(i.aspectRatio))throw new Error("Item "+r+" has an invalid aspect ratio");if(a||(a=n(t,e)),o=a.addItem(i),a.isLayoutComplete()){if(h=h.concat(s(t,e,a)),e._rows.length>=t.maxNumRows)return a=null,!0;if(a=n(t,e),!o&&(o=a.addItem(i),a.isLayoutComplete())){if(h=h.concat(s(t,e,a)),e._rows.length>=t.maxNumRows)return a=null,!0;a=n(t,e)}}})),a&&a.getItems().length&&t.showWidows&&(e._rows.length?(r=e._rows[e._rows.length-1].isBreakoutRow?e._rows[e._rows.length-1].targetRowHeight:e._rows[e._rows.length-1].height,a.forceComplete(!1,r)):a.forceComplete(!1),h=h.concat(s(t,e,a)),t._widowCount=a.getItems().length),e._containerHeight=e._containerHeight-t.boxSpacing.vertical,e._containerHeight=e._containerHeight+t.containerPadding.bottom,{containerHeight:e._containerHeight,widowCount:t._widowCount,boxes:e._layoutItems}}(h,c,a.map((function(t){return t.width&&t.height?{aspectRatio:t.width/t.height}:{aspectRatio:t}}))));var a,r,h,c,l,g,d;if(o.widowCount&&("center"===t.options.lastRow||"right"===t.options.lastRow)){const e=o.boxes[o.boxes.length-1];let n=i.containerWidth-e.width-e.left;"center"===t.options.lastRow&&(n/=2),"right"===t.options.lastRow&&(n-=i.containerPadding.right);for(let t=1;t<=o.widowCount;t+=1)o.boxes[o.boxes.length-t].left=o.boxes[o.boxes.length-t].left+n}t.options.isRtl&&o.boxes.forEach(((t,e)=>{o.boxes[e].left=i.containerWidth-o.boxes[e].left-o.boxes[e].width-i.containerPadding.right+i.containerPadding.left}));let u=0,p=0;const f={};t.images.forEach(((e,i)=>{if(o.boxes[u]&&e.width&&e.height){if(t.options.calculateItemsHeight&&void 0===f[o.boxes[u].top]&&Object.keys(f).length&&(p+=f[Object.keys(f).pop()]-o.boxes[i-1].height),t.options.transitionDuration&&1<t.justifyCount&&t.applyTransition(e.$item,["transform"]),t.css(e.$item,{display:"",position:"absolute",transform:`translateX(${o.boxes[u].left}px) translateY(${o.boxes[u].top+p}px) translateZ(0)`,width:`${o.boxes[u].width}px`}),t.options.calculateItemsHeight){const t=e.$item.getBoundingClientRect();(void 0===f[o.boxes[u].top]||f[o.boxes[u].top]<t.height)&&(f[o.boxes[u].top]=t.height)}u+=1}else t.css(e.$item,{display:"none"})})),t.options.calculateItemsHeight&&Object.keys(f).length&&(p+=f[Object.keys(f).pop()]-o.boxes[o.boxes.length-1].height),t.options.transitionDuration&&t.applyTransition(t.$container,["height"]),t.css(t.$container,{height:`${o.containerHeight+p}px`}),t.options.onJustify&&t.options.onJustify.call(t)}updateOptions(t){const e=this;e.options={...e.options,...t},e.justify()}destroy(){const t=this;t.removeFromFjGalleryList(),t.justifyCount=0,t.options.onDestroy&&t.options.onDestroy.call(t),t.css(t.$container,{height:"",transition:""}),t.images.forEach((e=>{t.css(e.$item,{position:"",transform:"",transition:"",width:"",height:""})})),t.images.forEach((t=>{delete t.$item.fjGalleryImage})),delete t.$container.fjGallery}resize(){this.justify()}}const u=function(t,e,...i){("object"==typeof HTMLElement?t instanceof HTMLElement:t&&"object"==typeof t&&null!==t&&1===t.nodeType&&"string"==typeof t.nodeName)&&(t=[t]);const o=t.length;let n,s=0;for(;s<o;s+=1)if("object"==typeof e||void 0===e?t[s].fjGallery||(t[s].fjGallery=new d(t[s],e)):t[s].fjGallery&&(n=t[s].fjGallery[e].apply(t[s].fjGallery,i)),void 0!==n)return n;return t};u.constructor=d;class p extends HTMLElement{constructor(){super(),this.justifiedContainer=this.querySelector(".fj-gallery"),this.config={itemSelector:this.getAttribute("data-item-selector")||".fj-gallery-item",gutter:Number(this.getAttribute("data-gutter"))||10},Shopify.designMode?(document.addEventListener("shopify:section:load",(()=>{this.init()})),document.addEventListener("shopify:inspector:activate",(()=>{this.init()}))):this.init()}init(){const{itemSelector:t,gutter:e}=this.config;u(this.justifiedContainer,{itemSelector:t,gutter:e})}}customElements.define("psb-justified",p)}();